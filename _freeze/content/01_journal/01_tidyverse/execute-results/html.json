{
  "hash": "04a073494b03bc2f408b20b7196ca814",
  "result": {
    "markdown": "---\ntitle: \"Tidyverse\"\nauthor: \"Adrian Florea\"\n---\n\n\n# Prepare Data for Analysis\n\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-1_b4324842b7f40f0168a280e20ebf45fa'}\n\n```{.r .cell-code}\n# Loading Libraries\nlibrary(tidyverse)\nlibrary(readxl)\n\n# Importing Files\nbikes_tbl <- read_excel(\"~/GitHub/ss24-bdsb-Adrian-0402/content/01_journal/01_tidyverse_files/01_bike_sales/01_raw_data/bikes.xlsx\")\norderlines_tbl <- read_excel(\"~/GitHub/ss24-bdsb-Adrian-0402/content/01_journal/01_tidyverse_files/01_bike_sales/01_raw_data/orderlines.xlsx\")\nbikeshops_tbl <- read_excel(\"~/GitHub/ss24-bdsb-Adrian-0402/content/01_journal/01_tidyverse_files/01_bike_sales/01_raw_data/bikeshops.xlsx\")\n\n# Joining Data \nbike_orderlines_joined_tbl <- orderlines_tbl %>%\n  left_join(bikes_tbl, by = c(\"product.id\" = \"bike.id\")) %>%\n  left_join(bikeshops_tbl, by = c(\"customer.id\" = \"bikeshop.id\"))\n\n# Wrangling Data\nbike_orderlines_wrangled_tbl <- bike_orderlines_joined_tbl %>%\n  separate( col = location,\n            into = c(\"city\",\"state\"),\n            sep = \", \") %>% \n  mutate(total.price = price * quantity) %>% \n  select(-...1, -gender) %>%\n  rename(bikeshop = name) %>% \n  set_names(names(.) %>% str_replace_all(\"\\\\.\", \"_\"))\n```\n:::\n\n\n# Analysis of the Data\n\n## By Location (State)\n\n\n::: {.cell hash='01_tidyverse_cache/html/plot1_eceee83459011775ac2743e47ff562fa'}\n\n```{.r .cell-code}\n# Manipulate\nsales_by_state_tbl <- bike_orderlines_wrangled_tbl %>% \n  select(state, total_price) %>% \n  group_by(state) %>% \n  summarize(sales = sum(total_price)) %>% \n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \" €\"))\n\n#Visualize\nsales_by_state_tbl %>%\n  ggplot(aes(x = state, y = sales)) +\n  geom_col(fill = \"#16C17C\") +\n  geom_label(aes(label = sales_text)) +\n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", \n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \" €\")) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +\n  labs(\n    title    = \"Revenue by state\",\n    x = \"\", # Override defaults for x and y\n    y = \"Revenue\"\n  )\n```\n\n::: {.cell-output-display}\n![Revenue by different states](01_tidyverse_files/figure-html/plot1-1.png){width=1440}\n:::\n:::\n\n\n## By Location (State) **and** year\n\n\n::: {.cell hash='01_tidyverse_cache/html/plot2_d778e2b846a3b54012ae584b80bd51a8'}\n\n```{.r .cell-code}\n# Manipulate\nlibrary(lubridate)\n\nsales_by_state_year_tbl <- bike_orderlines_wrangled_tbl %>%\n  select(state, order_date, total_price) %>% \n  mutate(year = year(order_date)) %>% \n  group_by(year, state) %>% \n  summarize(sales = sum(total_price)) %>% \n  ungroup() %>% \n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \" €\"))\n\n# Visualize\nsales_by_state_year_tbl %>%\n  \n  # Set up x, y, fill\n  ggplot(aes(x = year, y = sales, fill = state)) +\n  \n  # Geometries\n  geom_col() + # Run up to here to get a stacked bar plot\n  \n  # Facet\n  facet_wrap(~ state) +\n  \n  # Formatting\n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\",\n                                                    scale = 0.000001,\n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \"m €\")) +\n  labs(\n    title = \"Revenue by year and state\",\n    fill = \"States\" # Changes the legend name\n  )\n```\n\n::: {.cell-output-display}\n![Revenue by different states and year](01_tidyverse_files/figure-html/plot2-1.png){width=1440}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}