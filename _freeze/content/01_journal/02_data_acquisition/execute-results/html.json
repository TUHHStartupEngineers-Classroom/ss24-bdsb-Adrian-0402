{
  "hash": "45cc55f2fbc7f50516756a5ea8f5e616",
  "result": {
    "markdown": "---\ntitle: \"Data Acquisition\"\nauthor: \"Adrian Florea\"\n---\n\n\n# Getting some data through Spotify API\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-1_15cb5308e8cc90c5080988aec610f37f'}\n\n```{.r .cell-code}\n#Spotify API\n\nlibrary(spotifyr) #install via devtools::install_github('charlie86/spotifyr')\nlibrary(tidyverse)\nlibrary(lubridate)\n\n# can't use get_spotify_access_token() since function will prompt to website with \"Illegal scope\"\n# only way to bypass this broken API is to avoid certain scopes\nauth_object <- get_spotify_authorization_code(scope = scopes()[c(7,8,9,10,14,15)])\n\n\ntop_tracks_tbl <- get_my_top_artists_or_tracks(\n  type = \"tracks\",\n  limit = 20,\n  offset = 0,\n  time_range = \"medium_term\",\n  authorization = auth_object,\n  include_meta_info = FALSE\n) %>% as_tibble()\n\n\ntop_tracks_wrangled_tbl <- top_tracks_tbl %>%\n  mutate(duration_min = duration((duration_ms / 1000),\"seconds\")) %>% \n  select(artists,duration_min,name,popularity) %>% \n  rename(track_name = name) %>%\n  unnest(artists) %>% \n  rename(artists = name) %>%\n  select(artists,duration_min,track_name,popularity) %>%\n  group_by(duration_min,track_name,popularity) %>% \n  summarize(artists = paste(unique(artists), collapse = \", \")) %>%\n  select(artists,track_name,duration_min,popularity) %>% \n  arrange(desc(popularity))\n\ntop_tracks_wrangled_tbl %>% \n  head(n = 10)\n\n\n# A tibble: 10 × 4\n# Groups:   duration_min, track_name [10]\n#  artists                      track_name         duration_min             popularity\n#  <chr>                        <chr>              <Duration>                    <int>\n#1 Kenya Grace                  Strangers          172.964s (~2.88 minutes)         88\n#2 Dynoro, Gigi D'Agostino      In My Mind         184.56s (~3.08 minutes)          80\n#3 Vicetone                     Walk Thru Fire     194.482s (~3.24 minutes)         66\n#4 deadmau5, Rob Swire          Ghosts 'n' Stuff   328.253s (~5.47 minutes)         56\n#5 Vini Vici, Ranji, Halflives  Everyday Rockstars 209.375s (~3.49 minutes)         41\n#6 Aether, Sizzle Bird, Veela   Raccoon City       226.925s (~3.78 minutes)         38\n#7 Bensley, Skyelle             All I Wanted       244.137s (~4.07 minutes)         35\n#8 Draper, Laura Brehm          Pressure           318.537s (~5.31 minutes)         35\n#9 Tut Tut Child, Danyka Nadeau Breathe            275.121s (~4.59 minutes)         31\n#10 Nomyn, Veela                Be Honest          223.655s (~3.73 minutes)         30\n```\n:::\n\n\n# Webscraping - RADON Bikes\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-2_f16ed0174248c5ab8b96b514583fd4d8'}\n\n```{.r .cell-code}\n# Webscraping ----\n\n# 1.0 Libraries ----\nlibrary(tidyverse) # Main Package - Loads dplyr, purrr, etc.\nlibrary(rvest)     # HTML Hacking & Web Scraping\n\n# 1.1 Collect product categories ----\n\nurl_home <- \"https://www.radon-bikes.de/en/\"\nhtml_home <- read_html(url_home)\n\nbike_categories_chr <- html_home %>% \n  html_elements(css = \".megamenu__item a\") %>% \n  html_attr('href') %>% \n  str_subset(\"wear\", negate = TRUE) |>\n  str_c(\"https://www.radon-bikes.de\",  ... = _) %>% \n  paste(\"bikegrid/\", sep = \"\")\n  \n\n# 2.0 Collect bike data ----\n\nbike_category_url <- bike_categories_chr[2]\nhtml_bike_category <- bike_category_url %>% \n  read_html()\n\nbike_url_chr <- html_bike_category %>% \n  html_elements(css = \".m-bikegrid__info a\") %>% \n  html_attr('href') |>\n  str_c(\"https://www.radon-bikes.de\",  ... = _)\n  \n\n# 2.1 Make a function ----\n\nget_bike_urls <- function(url) {\n  \n  html_bike_category <- read_html(url)\n  \n  bike_url_chr <- html_bike_category %>% \n    html_elements(css = \".m-bikegrid__info a\") %>% \n    html_attr('href') |>\n    str_c(\"https://www.radon-bikes.de\",  ... = _)\n  \n  return(bike_url_chr)\n}\n\n# Get all bike urls\nbike_urls_chr <- map(bike_categories_chr,get_bike_urls)\n\n# 3.1 Subsetting ----\n\n# Unnest the mess into one column\nbike_urls_tbl <- bike_urls_chr %>% \n  as_tibble_col(column_name = \"url\") %>% \n  unnest(cols = c(\"url\")) %>% \n  unique() %>% \n  tidyr::separate_wider_regex(cols = url, patterns = c(\".*de/en/\", family   = \"[^/]*\", \"/\",\n                                                       category = \"[^/]*\", \"/\",\n                                                       model    = \"[^/]*\", \"/\",\n                                                       \".*\"), cols_remove = F)\n\n# Select one category to analyze\nbike_urls_fullsuspension_tbl <- bike_urls_tbl %>% \n  filter(category == \"fullsuspension\")\n\n# 3.2 Get different data for 1 bike ----\n\nhtml_bike_model <- read_html(bike_urls_fullsuspension_tbl$url[1])\n\nbike_model <- html_bike_model %>% \n  html_elements(css = \".m-bikedetail__overlays-top .a-heading--medium\") %>% \n  html_text() %>% \n  str_squish()\n\nbike_price <- html_bike_model %>% \n  html_elements(css = \".m-bikedetail__price--active\") %>% \n  html_text() %>% \n  .[1] %>% \n  parse_number() %>% \n  round()\n\nbike_weight <- html_bike_model %>% \n  html_elements(css = \".spec-42 .m-feature-list__description\") %>% \n  html_text() %>% \n  str_extract(\"[0-9]*[.,]*[0-9]*\")  %>% \n  str_replace(\"\\\\,\",\"\\\\.\") %>% \n  as.numeric()\n\n# 3.3 Make a function ----\n\nget_model_data <- function(url) {\n  \n  html_bike_model <- read_html(url)\n  \n  bike_model <- html_bike_model %>% \n    html_elements(css = \".m-bikedetail__overlays-top .a-heading--medium\") %>% \n    html_text() %>% \n    str_squish()\n  \n  bike_price <- html_bike_model %>% \n    html_elements(css = \".m-bikedetail__price--active\") %>% \n    html_text() %>% \n    .[1] %>% \n    parse_number() %>% \n    round()\n  \n  bike_weight <- html_bike_model %>% \n    html_elements(css = \".spec-42 .m-feature-list__description\") %>% \n    html_text() %>% \n    str_extract(\"[0-9]*[.,]*[0-9]*\")  %>% \n    str_replace(\"\\\\,\",\"\\\\.\") %>% \n    as.numeric()\n  \n  bike_data <- tibble(url   = url,\n                      model = bike_model,\n                      price = bike_price,\n                      weight = bike_weight)\n  \n  return(bike_data)\n}\n\n# 3.4 Test functions ----\n\n# For one bike\n# bike_model_data_tbl <- get_model_data(url = bike_urls_fullsuspension_tbl$url[1])\n\n# For one category\nbike_model_data_tbl <- bike_urls_fullsuspension_tbl$url %>% map_dfr(get_model_data)\n\n# For ALL categories\n# bike_model_data_tbl <- bike_urls_tbl$url %>% map_dfr(get_model_data)\n\n# 3.5 Join Data ----\n\n# For one category\nbike_model_data_joined_tbl <- bike_urls_fullsuspension_tbl %>% \n  left_join(bike_model_data_tbl, by = join_by(\"url\"))\n\n# For ALL categories\n# bike_model_data_joined_tbl <- bike_urls_tbl %>% \n#  left_join(bike_model_data_tbl, by = join_by(\"url\"))\n\n# 4 Print for category \"fullsuspension\"\n\nbike_model_data_joined_tbl %>% \n  head(n = 10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"family\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"category\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"model.x\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"url\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"model.y\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"price\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"weight\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"skeen-trail-al\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/skeen-trail-al/skeen-trail-al-70-2023/\",\"5\":\"SKEEN TRAIL AL 7.0\",\"6\":\"1428\",\"7\":\"14.45\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"skeen-trail-al\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/skeen-trail-al/skeen-trail-al-80-2023/\",\"5\":\"SKEEN TRAIL AL 8.0\",\"6\":\"1680\",\"7\":\"14.35\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"skeen-trail\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/skeen-trail/skeen-trail-90-2023/\",\"5\":\"SKEEN TRAIL 9.0\",\"6\":\"1848\",\"7\":\"13.45\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"skeen-trail\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/skeen-trail/skeen-trail-100-2023/\",\"5\":\"SKEEN TRAIL 10.0\",\"6\":\"2184\",\"7\":\"13.25\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"skeen-trail\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/skeen-trail/skeen-trail-100-hd-2023/\",\"5\":\"SKEEN TRAIL 10.0 HD\",\"6\":\"2688\",\"7\":\"13.75\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"slide-trail-al\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/slide-trail-al/slide-trail-al-70-2024/\",\"5\":\"SLIDE TRAIL AL 7.0\",\"6\":\"1848\",\"7\":\"14.90\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"slide-trail-al\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/slide-trail-al/slide-trail-al-80-2024/\",\"5\":\"SLIDE TRAIL AL 8.0\",\"6\":\"2268\",\"7\":\"14.95\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"slide-trail-al\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/slide-trail-al/slide-trail-al-70-2023/\",\"5\":\"SLIDE TRAIL AL 7.0\",\"6\":\"1512\",\"7\":\"14.70\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"slide-trail-al\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/slide-trail-al/slide-trail-al-80-2023/\",\"5\":\"SLIDE TRAIL AL 8.0\",\"6\":\"1764\",\"7\":\"15.10\"},{\"1\":\"mountainbike\",\"2\":\"fullsuspension\",\"3\":\"slide-trail\",\"4\":\"https://www.radon-bikes.de/en/mountainbike/fullsuspension/slide-trail/slide-trail-100-hd-2024/\",\"5\":\"SLIDE TRAIL 10.0 HD\",\"6\":\"4033\",\"7\":\"13.95\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# A tibble: 10 × 7\n#   family       category       model.x        url                        model.y price weight\n#   <chr>        <chr>          <chr>          <chr>                      <chr>   <dbl>  <dbl>\n#1  mountainbike fullsuspension skeen-trail-al https://www.radon-bikes.d… SKEEN …  1428   14.4\n#2  mountainbike fullsuspension skeen-trail-al https://www.radon-bikes.d… SKEEN …  1680   14.4\n#3  mountainbike fullsuspension skeen-trail    https://www.radon-bikes.d… SKEEN …  1848   13.4\n#4  mountainbike fullsuspension skeen-trail    https://www.radon-bikes.d… SKEEN …  2184   13.2\n#5  mountainbike fullsuspension skeen-trail    https://www.radon-bikes.d… SKEEN …  2688   13.8\n#6  mountainbike fullsuspension slide-trail-al https://www.radon-bikes.d… SLIDE …  1848   14.9\n#7  mountainbike fullsuspension slide-trail-al https://www.radon-bikes.d… SLIDE …  2268   15.0\n#8  mountainbike fullsuspension slide-trail-al https://www.radon-bikes.d… SLIDE …  1512   14.7\n#9  mountainbike fullsuspension slide-trail-al https://www.radon-bikes.d… SLIDE …  1764   15.1\n#10 mountainbike fullsuspension slide-trail    https://www.radon-bikes.d… SLIDE …  4033   14.0\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}