{
  "hash": "3a4b0f5d8a13fc7b241517af0591d2be",
  "result": {
    "markdown": "---\ntitle: \"Data Wrangling\"\nauthor: \"Adrian Florea\"\n---\n\n\n# Wrangling with Large Files [original data]\n\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-1_750da973fa2852d3f4cd20aff7992b0a'}\n\n```{.r .cell-code}\n# 1.0 LIBRARIES ----\n\n# Tidyverse\nlibrary(tidyverse)\nlibrary(vroom)\n\n# Data Table\nlibrary(data.table)\n\n# 2.0 DATA IMPORT ----\n# Data is from April 22, 2024\n# Import files used:\n# g_assignee_disambiguated: Disambiguated assignee data for granted patents.\n# g_patent: Data on granted patents.\n# g_uspc_at_issue: USPC classification data for all granted patents at issue.\n\n# 2.1 Assignee Data ----\n\ncol_types_1 <- list(\n  patent_id = col_character(),\n  assignee_sequence = col_skip(),\n  assignee_id = col_character(),\n  disambig_assignee_individual_name_first = col_character(),\n  disambig_assignee_individual_name_last = col_character(),\n  disambig_assignee_organization = col_character(),\n  assignee_type = col_skip(),\n  location_id = col_skip()\n)\n\nassignee_data <- vroom(\n  file       = \"~/GitHub/ss24-bdsb-Adrian-0402/source_data/wrangling_data/full_data/g_assignee_disambiguated.tsv\", \n  delim      = \"\\t\", \n  col_types  = col_types_1,\n  na         = c(\"\", \"NA\", \"NULL\")\n)\n\n# 2.2 Patent Data ----\n\ncol_types_2 <- list(\n  patent_id = col_character(),\n  patent_type = col_skip(),\n  patent_date = col_date(\"%Y-%m-%d\"),\n  patent_title = col_character(),\n  patent_abstract = col_skip(),\n  wipo_kind = col_skip(),\n  num_claims = col_skip(),\n  withdrawn = col_skip(),\n  filename = col_skip()\n)\n\npatent_data <- vroom(\n  file       = \"~/GitHub/ss24-bdsb-Adrian-0402/source_data/wrangling_data/full_data/g_patent.tsv\", \n  delim      = \"\\t\", \n  col_types  = col_types_2,\n  na         = c(\"\", \"NA\", \"NULL\")\n)\n\n# 2.3 USPC Data ----\n\ncol_types_3 <- list(\n  patent_id = col_character(),\n  uspc_sequence = col_double(),\n  uspc_mainclass_id = col_character(),\n  uspc_mainclass_title = col_character(),\n  uspc_subclass_id = col_skip(),    #ignore since we only look at mainclasses\n  uspc_subclass_title = col_skip()\n)\n\nuspc_data <- vroom(\n  file       = \"~/GitHub/ss24-bdsb-Adrian-0402/source_data/wrangling_data/full_data/g_uspc_at_issue.tsv\", \n  delim      = \"\\t\", \n  col_types  = col_types_3,\n  na         = c(\"\", \"NA\", \"NULL\")\n)\n\n# 3.0 TRANSFORM DATA ----\n\nsetDT(assignee_data)\nsetDT(patent_data)\nsetDT(uspc_data)\n\n# 4.0 DATA WRANGLING ----\n\n# 4.1 Joining / Merging Data ----\n\ncombined_patent_data <- merge(assignee_data,patent_data,\n                              by = \"patent_id\",\n                              all.x = TRUE,\n                              all.y = FALSE)\n# free space\nrm(patent_data)\n\ncombined_uspc_data <- merge(assignee_data,uspc_data,\n                            by = \"patent_id\",\n                            all.x = TRUE,\n                            all.y = FALSE)\n# Remove uncountable rows and free space\ncombined_uspc_data <- combined_uspc_data[!is.na(uspc_mainclass_id)]\nrm(uspc_data)\n\n# 4.2 Set keys\n\nsetkey(assignee_data, \"assignee_id\")\nsetkey(combined_patent_data, \"assignee_id\")\nsetkey(combined_uspc_data, \"uspc_mainclass_id\")\n\n# 5.0 QUESTIONS ----\n\n# 5.1 Question 1: Patent Dominance: What US company / corporation has the most patents? \n#     List the 10 US companies with the most assigned/granted patents\n\nquestion_1_dt <- assignee_data[, .N , by = .(assignee_id,\n                                          disambig_assignee_individual_name_first,\n                                          disambig_assignee_individual_name_last,\n                                          disambig_assignee_organization)][order(-N)] %>% \n  setnames(\"disambig_assignee_individual_name_first\",\"first_name\") %>% \n  setnames(\"disambig_assignee_individual_name_last\",\"last_name\") %>% \n  setnames(\"disambig_assignee_organization\",\"company\") %>% \n  head(n = 10)\n\n# 5.2 Question 2: Recent patent activity: What US company had the most patents\n#     granted in 2019? List the top 10 companies with the most new granted \n#     patents for 2019.\n\nquestion_2_dt <- \n  combined_patent_data[year(patent_date) == 2019, .N, by = .(assignee_id,\n                                                             disambig_assignee_individual_name_first,\n                                                             disambig_assignee_individual_name_last,\n                                                             disambig_assignee_organization)][order(-N)] %>% \n  setnames(\"disambig_assignee_individual_name_first\",\"first_name\") %>% \n  setnames(\"disambig_assignee_individual_name_last\",\"last_name\") %>% \n  setnames(\"disambig_assignee_organization\",\"company\") %>% \n  head(n = 10)\n\n# 5.3 Question 3: Innovation in Tech: What is the most innovative tech sector? \n#     For the top 10 companies (worldwide) with the most patents, \n#     what are the top 5 USPTO tech main classes?\n\n# Note top 10 companies first\ncompare_company = question_1_dt$assignee_id\n\n# Subset all the patents for only the top 10 companies\n# Allow counting multiple uspc mainclasses for a patent, since subclasses would differ\nquestion_3_dt <- \n  combined_uspc_data[assignee_id %in% compare_company, .N, by = uspc_mainclass_id][order(-N)] %>% \n  head(n = 5)\n```\n:::\n\n\n# Print Solutions\n\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-2_34acf7326b16e7441ce97b135df6b6c7'}\n\n```{.r .cell-code}\n# IBM has the most patents!\nquestion_1_dt\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"assignee_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"first_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"N\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"131272b5-c296-4ef9-b2ae-2e34e9055490\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"INTERNATIONAL BUSINESS MACHINES CORPORATION\",\"5\":\"160160\"},{\"1\":\"15236fce-f79c-483e-b5b5-8d60943a8bf9\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Samsung Display Co., Ltd.\",\"5\":\"156237\"},{\"1\":\"472e89f2-7f69-4842-b4c3-1510ef2a67ed\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"CANON KABUSHIKI KAISHA\",\"5\":\"86653\"},{\"1\":\"6c6a4254-2e4a-4484-860a-864e676019f1\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"SONY CORPORATION\",\"5\":\"60551\"},{\"1\":\"972289d2-a66f-4134-b40b-066e1037511e\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"FUJITSU LIMITED\",\"5\":\"56009\"},{\"1\":\"93e2cc72-3302-4a3b-b9a0-cf1fb1a20495\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Kabushiki Kaisha Toshiba\",\"5\":\"52494\"},{\"1\":\"06494a2a-f3dc-447d-b232-5ee9b3626b2c\",\"2\":\"Damian\",\"3\":\"Wasserbauer\",\"4\":\"General Electric Company\",\"5\":\"50946\"},{\"1\":\"47e99f6a-c8a3-4528-9e74-4f062bbe239e\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Intel Corporation\",\"5\":\"49717\"},{\"1\":\"3fbb081d-e8d9-4ab9-baf8-0b28f955480c\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"HITACHI, LTD.\",\"5\":\"45683\"},{\"1\":\"a71a6820-024a-48c3-9fac-b20f17c93e35\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"LG ELECTRONICS INC.\",\"5\":\"44975\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Samsung had the most newly granted patents in 2019!\nquestion_2_dt\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"assignee_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"first_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"last_name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"N\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"15236fce-f79c-483e-b5b5-8d60943a8bf9\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Samsung Display Co., Ltd.\",\"5\":\"9961\"},{\"1\":\"131272b5-c296-4ef9-b2ae-2e34e9055490\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"INTERNATIONAL BUSINESS MACHINES CORPORATION\",\"5\":\"9268\"},{\"1\":\"472e89f2-7f69-4842-b4c3-1510ef2a67ed\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"CANON KABUSHIKI KAISHA\",\"5\":\"3594\"},{\"1\":\"a71a6820-024a-48c3-9fac-b20f17c93e35\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"LG ELECTRONICS INC.\",\"5\":\"3314\"},{\"1\":\"35e17eb6-f79c-4e18-b44a-da23f3fb29e5\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Microsoft Technology Licensing, LLC\",\"5\":\"3104\"},{\"1\":\"47e99f6a-c8a3-4528-9e74-4f062bbe239e\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Intel Corporation\",\"5\":\"3059\"},{\"1\":\"f94215a0-b0d5-4aba-88de-614ff1829c0c\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Apple Inc.\",\"5\":\"2818\"},{\"1\":\"d7e8a0a1-0ccc-48ad-b397-5e277926b45b\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Ford Global Technologies, LLC\",\"5\":\"2624\"},{\"1\":\"b105619e-441d-4894-ba22-88bf5d8efad2\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"Amazon Technologies, Inc.\",\"5\":\"2535\"},{\"1\":\"6d582076-3e9a-4d45-a45e-413b8e9b2b16\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"HUAWEI TECHNOLOGIES CO. LTD.\",\"5\":\"2454\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Top 5 main classes : 257, 438, 370, 430, 365 (considering only the top 10)\nquestion_3_dt\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"uspc_mainclass_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"N\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"257\",\"2\":\"108653\"},{\"1\":\"438\",\"2\":\"64315\"},{\"1\":\"370\",\"2\":\"51674\"},{\"1\":\"430\",\"2\":\"45380\"},{\"1\":\"365\",\"2\":\"44851\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}