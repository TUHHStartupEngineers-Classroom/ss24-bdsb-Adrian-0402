{
  "hash": "b929681a33449d8fb392522c0fef0b9d",
  "result": {
    "markdown": "---\ntitle: \"Data Wrangling\"\nauthor: \"Adrian Florea\"\n---\n\n\n# Wrangling with Large Files [original data]\n\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-1_c38d76b3c77c2efa024b80c858e11a0b'}\n\n```{.r .cell-code}\n# 1.0 LIBRARIES ----\n\n# Tidyverse\nlibrary(tidyverse)\nlibrary(vroom)\n\n# Data Table\nlibrary(data.table)\n\n# 2.0 DATA IMPORT ----\n# Data is from April 22, 2024\n# Import files used:\n# g_assignee_disambiguated: Disambiguated assignee data for granted patents.\n# g_patent: Data on granted patents.\n# g_uspc_at_issue: USPC classification data for all granted patents at issue.\n\n# 2.1 Assignee Data ----\n\ncol_types_1 <- list(\n  patent_id = col_character(),\n  assignee_sequence = col_skip(),\n  assignee_id = col_character(),\n  disambig_assignee_individual_name_first = col_character(),\n  disambig_assignee_individual_name_last = col_character(),\n  disambig_assignee_organization = col_character(),\n  assignee_type = col_double(),\n  location_id = col_skip()\n)\n\nassignee_data <- vroom(\n  file       = \"~/GitHub/ss24-bdsb-Adrian-0402/source_data/wrangling_data/full_data/g_assignee_disambiguated.tsv\", \n  delim      = \"\\t\", \n  col_types  = col_types_1,\n  na         = c(\"\", \"NA\", \"NULL\")\n)\n\n# 2.2 Patent Data ----\n\ncol_types_2 <- list(\n  patent_id = col_character(),\n  patent_type = col_skip(),\n  patent_date = col_date(\"%Y-%m-%d\"),\n  patent_title = col_character(),\n  patent_abstract = col_skip(),\n  wipo_kind = col_skip(),\n  num_claims = col_skip(),\n  withdrawn = col_skip(),\n  filename = col_skip()\n)\n\npatent_data <- vroom(\n  file       = \"~/GitHub/ss24-bdsb-Adrian-0402/source_data/wrangling_data/full_data/g_patent.tsv\", \n  delim      = \"\\t\", \n  col_types  = col_types_2,\n  na         = c(\"\", \"NA\", \"NULL\")\n)\n\n# 2.3 USPC Data ----\n\ncol_types_3 <- list(\n  patent_id = col_character(),\n  uspc_sequence = col_double(),\n  uspc_mainclass_id = col_character(),\n  uspc_mainclass_title = col_character(),\n  uspc_subclass_id = col_skip(),    #ignore since we only look at mainclasses\n  uspc_subclass_title = col_skip()\n)\n\nuspc_data <- vroom(\n  file       = \"~/GitHub/ss24-bdsb-Adrian-0402/source_data/wrangling_data/full_data/g_uspc_at_issue.tsv\", \n  delim      = \"\\t\", \n  col_types  = col_types_3,\n  na         = c(\"\", \"NA\", \"NULL\")\n)\n\n# 3.0 TRANSFORM DATA ----\n\nsetDT(assignee_data)\nsetDT(patent_data)\nsetDT(uspc_data)\n\n# 4.0 DATA WRANGLING ----\n\n# 4.1 Joining / Merging Data ----\n\ncombined_patent_data <- merge(assignee_data,patent_data,\n                              by = \"patent_id\",\n                              all.x = TRUE,\n                              all.y = FALSE)\n# free space\nrm(patent_data)\n\ncombined_uspc_data <- merge(assignee_data,uspc_data,\n                            by = \"patent_id\",\n                            all.x = TRUE,\n                            all.y = FALSE)\n# Remove uncountable rows and free space\ncombined_uspc_data <- combined_uspc_data[!is.na(uspc_mainclass_id)]\nrm(uspc_data)\n\n# 4.2 Set keys\n\nsetkey(assignee_data, \"assignee_id\")\nsetkey(combined_patent_data, \"assignee_id\")\nsetkey(combined_uspc_data, \"uspc_mainclass_id\")\n\n# 5.0 QUESTIONS ----\n\n# 5.1 Question 1: Patent Dominance: What US company / corporation has the most patents? \n#     List the 10 US companies with the most assigned/granted patents\n#     Important: Assignee type 2 filters by US companies\n\nquestion_1_dt <- assignee_data[assignee_type == 2, .N , by = .(assignee_id,\n                                             disambig_assignee_organization)][order(-N)] %>% \n  setnames(\"disambig_assignee_organization\",\"company\") %>% \n  head(n = 10)\n\n# 5.2 Question 2: Recent patent activity: What US company had the most patents\n#     granted in 2019? List the top 10 companies with the most new granted \n#     patents for 2019. \n#     Also filter by type 2 for US companies.\n\nquestion_2_dt <- \n  combined_patent_data[year(patent_date) == 2019 & assignee_type == 2, .N, by = .(assignee_id,\n                                                                                  disambig_assignee_organization)][order(-N)] %>% \n  setnames(\"disambig_assignee_organization\",\"company\") %>% \n  head(n = 10)\n\n# 5.3 Question 3: Innovation in Tech: What is the most innovative tech sector? \n#     For the top 10 companies (worldwide) with the most patents, \n#     what are the top 5 USPTO tech main classes?\n\n# Note top 10 companies (worldwide) first\ncompare_company <- assignee_data[, .N, by = .(assignee_id)][order(-N),.(assignee_id)] %>% \n  head(n = 10) %>% \n  pull()\n\n# Subset all the patents for only the top 10 companies\n# Allow counting multiple uspc mainclasses for a patent, since subclasses would differ\nquestion_3_dt <- \n  combined_uspc_data[assignee_id %in% compare_company, .N, by = .(uspc_mainclass_id,\n                                                                  uspc_mainclass_title)][order(-N)] %>% \n  head(n = 5)\n```\n:::\n\n\n# Print Solutions\n\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-2_a12a4d140fec55bf6b80a54a1fe1c1bc'}\n\n```{.r .cell-code}\n# IBM has the most patents.\nquestion_1_dt\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"assignee_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"N\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"131272b5-c296-4ef9-b2ae-2e34e9055490\",\"2\":\"INTERNATIONAL BUSINESS MACHINES CORPORATION\",\"3\":\"160160\"},{\"1\":\"06494a2a-f3dc-447d-b232-5ee9b3626b2c\",\"2\":\"General Electric Company\",\"3\":\"50946\"},{\"1\":\"47e99f6a-c8a3-4528-9e74-4f062bbe239e\",\"2\":\"Intel Corporation\",\"3\":\"49717\"},{\"1\":\"21d27da9-33be-4d4b-a94e-685c1525c9aa\",\"2\":\"QUALCOMM Incorporated\",\"3\":\"35540\"},{\"1\":\"b97fbbf3-9b55-472c-a9fc-c094c954795b\",\"2\":\"Micron Technology, Inc.\",\"3\":\"35468\"},{\"1\":\"f94215a0-b0d5-4aba-88de-614ff1829c0c\",\"2\":\"Apple Inc.\",\"3\":\"33004\"},{\"1\":\"09a71a64-df4e-4a9e-a137-48239654ee9f\",\"2\":\"Microsoft Corporation\",\"3\":\"30245\"},{\"1\":\"200759c4-8bd1-44a2-9444-c20ae07388bb\",\"2\":\"TEXAS INSTRUMENTS INCORPORATED\",\"3\":\"27894\"},{\"1\":\"74d18aa5-bde3-4464-9158-9297522b409a\",\"2\":\"GOOGLE LLC\",\"3\":\"27846\"},{\"1\":\"f6966377-f838-4376-8120-adcb10f7ab91\",\"2\":\"Hewlett-Packard Development Company, L.P.\",\"3\":\"26800\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# IBM also had the most newly granted patents in 2019.\nquestion_2_dt\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"assignee_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"N\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"131272b5-c296-4ef9-b2ae-2e34e9055490\",\"2\":\"INTERNATIONAL BUSINESS MACHINES CORPORATION\",\"3\":\"9263\"},{\"1\":\"35e17eb6-f79c-4e18-b44a-da23f3fb29e5\",\"2\":\"Microsoft Technology Licensing, LLC\",\"3\":\"3102\"},{\"1\":\"47e99f6a-c8a3-4528-9e74-4f062bbe239e\",\"2\":\"Intel Corporation\",\"3\":\"3029\"},{\"1\":\"f94215a0-b0d5-4aba-88de-614ff1829c0c\",\"2\":\"Apple Inc.\",\"3\":\"2500\"},{\"1\":\"d7e8a0a1-0ccc-48ad-b397-5e277926b45b\",\"2\":\"Ford Global Technologies, LLC\",\"3\":\"2468\"},{\"1\":\"b105619e-441d-4894-ba22-88bf5d8efad2\",\"2\":\"Amazon Technologies, Inc.\",\"3\":\"2435\"},{\"1\":\"21d27da9-33be-4d4b-a94e-685c1525c9aa\",\"2\":\"QUALCOMM Incorporated\",\"3\":\"2358\"},{\"1\":\"74d18aa5-bde3-4464-9158-9297522b409a\",\"2\":\"GOOGLE LLC\",\"3\":\"2111\"},{\"1\":\"06494a2a-f3dc-447d-b232-5ee9b3626b2c\",\"2\":\"General Electric Company\",\"3\":\"1819\"},{\"1\":\"99fdd87c-08d6-4348-bd90-ec8ee3c77144\",\"2\":\"The Boeing Company\",\"3\":\"1382\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Most innovative tech sector: ACTIVE SOLID-STATE DEVICES (E.G., TRANSISTORS, SOLID-STATE DIODES)\n# Top 5 main classes : 257, 438, 370, 430, 365 (considering only the top 10)\nquestion_3_dt\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"uspc_mainclass_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"uspc_mainclass_title\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"N\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"257\",\"2\":\"ACTIVE SOLID-STATE DEVICES (E.G., TRANSISTORS, SOLID-STATE DIODES)\",\"3\":\"108653\"},{\"1\":\"438\",\"2\":\"SEMICONDUCTOR DEVICE MANUFACTURING: PROCESS\",\"3\":\"64315\"},{\"1\":\"370\",\"2\":\"MULTIPLEX COMMUNICATIONS\",\"3\":\"51674\"},{\"1\":\"430\",\"2\":\"RADIATION IMAGERY CHEMISTRY: PROCESS, COMPOSITION, OR PRODUCT THEREOF\",\"3\":\"45380\"},{\"1\":\"365\",\"2\":\"STATIC INFORMATION STORAGE AND RETRIEVAL\",\"3\":\"44851\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}