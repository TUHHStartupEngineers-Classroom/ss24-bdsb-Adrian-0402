{
  "hash": "9e433d28637eefca3fd7a54a07ad6ba0",
  "result": {
    "markdown": "---\ntitle: \"Data Visualization\"\nauthor: \"Adrian Florea\"\n---\n\n\n# Cumulative COVID-19 Cases\n\n\n::: {.cell hash='04_data_visualization_cache/html/unnamed-chunk-1_e511cbe998f5e62f6902cd0ba30f73f1'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(ggthemes)\n\ncovid_data_tbl <- read_csv(\"https://covid.ourworldindata.org/data/owid-covid-data.csv\")\n\n# 1.0 Data Manipulation ----\n\nfilter_countries <- c(\"Germany\", \"United Kingdom\", \"France\", \"Spain\", \"United States\")\n\ncovid_cum_cases <- covid_data_tbl %>% \n  select(location, date, total_cases) %>% \n  filter(location %in% filter_countries,\n         year(date) < 2022 |\n         year(date) == 2022 & month(date) < 5 & day(date) <= 19) %>% \n  mutate(across(total_cases, ~replace_na(., 0))) %>% \n  mutate(label_text = scales::number(total_cases,\n                                     big.mark = \".\"))\n\neurope_cases <- covid_data_tbl %>% \n  select(continent,date,total_cases) %>% \n  filter(continent == \"Europe\",\n         year(date) < 2022 |\n         year(date) == 2022 & month(date) < 5 & day(date) <= 19) %>% \n  mutate(across(total_cases, ~replace_na(., 0))) %>%\n  group_by(continent,date) %>% \n  summarize(total_cases = sum(total_cases)) %>% \n  mutate(label_text_E = scales::number(total_cases,\n                                     big.mark = \".\"))\n\ncustom_label_country <- covid_cum_cases %>% \n  filter(date == \"2022-04-19\" & location == \"United States\")\n\ncustom_label_europe <- europe_cases %>% \n  filter(date == \"2022-04-19\")\n\n# 2.0 Data Visualization ----\n\ncovid_cum_cases %>%\n  \n  ggplot(aes(date, total_cases, color = location)) +\n  \n  # Geometries\n  geom_smooth(method = \"loess\", span = 0.05, size = 0.7) +\n  geom_smooth(data = europe_cases, aes(color = continent), method = \"loess\", span = 0.05, size = 0.7) +\n  geom_label(data = custom_label_country, aes(label = label_text),\n             nudge_x = -80, show.legend = FALSE) +\n  geom_label(data = custom_label_europe, aes(label = label_text_E, color = continent),\n             nudge_x = -100, nudge_y = -30, show.legend = FALSE) + \n  \n  # Scales\n  scale_y_continuous(labels = scales::number_format(scale = 1/1e6,\n                                                    suffix = \"M\")) +\n  scale_x_date(breaks = \"1 month\",date_labels = \"%B '%y\", position = \"bottom\") +\n  \n  # Themes\n  theme_dark() + \n  scale_color_viridis_d(option = \"H\") + \n\n  theme(\n    axis.text.x = element_text(\n      angle = 45,\n      hjust = 1\n    ),\n    legend.position = \"bottom\") +\n  \n  guides(color = guide_legend(nrow = 2)) +\n\n  # Labels\n  labs(\n  title = \"COVID-19 confirmed cases worldwide\",\n  subtitle = \"As of 19/04/2022\",\n  x = \"\",\n  y = \"Cumulative Cases\",\n  color = \"Continent / Country\"\n  )\n```\n\n::: {.cell-output-display}\n![](04_data_visualization_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n# COVID-19 Deaths per relative population size\n\n\n::: {.cell hash='04_data_visualization_cache/html/unnamed-chunk-2_855a0387f73cffc8e26348c8c36124bd'}\n\n```{.r .cell-code}\n# 3.0 Data Manipulation Challenge 2 ----\n\nworld <- map_data(\"world\")\n\ncovid_deaths_pop <- covid_data_tbl %>% \n  filter(!is.na(continent) & year(date) == 2022 & month(date) == 12 & day(date) == 31) %>% \n  select(location,population,total_deaths,date) %>% \n  mutate(across(total_deaths, ~replace_na(., 0))) %>% \n  mutate(deaths_pop = total_deaths / population) %>% \n  \n  mutate(location = case_when(\n    location == \"United Kingdom\" ~ \"UK\",\n    location == \"United States\" ~ \"USA\",\n    location == \"Democratic Republic of Congo\" ~ \"Democratic Republic of the Congo\",\n    TRUE ~ location\n  )) %>% \n  distinct()\n\ncovid_deaths_pop_joined <- covid_deaths_pop %>% \n  right_join(world, join_by(location == region))\n\n# Choose stopping point at end of 2022, since many countries stopped reporting during 2023\n\n# 4.0 Data Visualization Challenge 2 ----\n\ncovid_deaths_pop_joined %>% \n  \n  ggplot(aes(fill = deaths_pop, map_id = location)) +\n  \n  # Geometries\n  geom_map(map = world, color = \"grey65\", linewidth = 0.01) +\n  \n  # Scales\n  scale_fill_continuous(low = \"#e3595d\", high = \"#520104\",\n                        labels = scales::percent_format(accuracy = 0.1)) +\n  \n  expand_limits(x = world$long, y = world$lat) +\n  \n  # Themes\n  theme_map() +\n  \n  theme(\n    legend.position = c(-0.1, 0.35),\n    plot.margin = unit(c(0.5, 0, 0, 2), \"cm\"),\n    plot.background = element_rect(fill = \"#0a1b30\"),\n    legend.background = element_rect(fill = \"#0a1b30\"),\n    text = element_text(color = \"white\")\n  ) +\n  \n  # Labels\n  labs(\n    title = \"Confirmed COVID-19 deaths relative to population size\",\n    subtitle = \"As of 31/12/2022\",\n    fill = \"Mortality Rate\"\n  )\n```\n\n::: {.cell-output-display}\n![](04_data_visualization_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}